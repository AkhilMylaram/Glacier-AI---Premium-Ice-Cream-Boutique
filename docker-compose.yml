
version: '3.8'

services:
  # --- Frontend Application (Served via Nginx on Port 80) ---
  frontend:
    build:
      context: .
      dockerfile: docker-files/frontend.Dockerfile
      args:
        - API_KEY=${API_KEY}
    ports:
      - "80:80"
    environment:
      - NODE_ENV=production
    depends_on:
      - api-gateway
    networks:
      - glacier-network
    restart: always

  # --- API Gateway (Entry point for Microservices on Port 8080) ---
  api-gateway:
    build:
      context: .
      dockerfile: docker-files/apigateway.Dockerfile
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
    depends_on:
      - auth-service
      - catalog-service
    networks:
      - glacier-network
    restart: always

  # --- Authentication Service (Internal Identity Node) ---
  auth-service:
    build:
      context: .
      dockerfile: docker-files/authentication.Dockerfile
    environment:
      - PORT=3001
      - NODE_ENV=production
    networks:
      - glacier-network
    restart: always

  # --- Catalog & Order Service (Internal Resource Node) ---
  catalog-service:
    build:
      context: .
      dockerfile: docker-files/catalog.Dockerfile
    environment:
      - PORT=3002
      - NODE_ENV=production
    networks:
      - glacier-network
    restart: always

networks:
  glacier-network:
    driver: bridge
